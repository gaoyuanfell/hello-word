 var rule = '{"code":200,"success":true,"items":[{"childRights":[{"id":37,"rightName":"查看客户","verify":"ViewCustomer"},{"id":38,"rightName":"审核客户","verify":"AuditCustomer"},{"id":39,"rightName":"管理客户","verify":"ManageCustomer"},{"id":37,"rightName":"查看客户","verify":"ViewCustomer"},{"id":38,"rightName":"审核客户","verify":"AuditCustomer"},{"id":39,"rightName":"管理客户","verify":"ManageCustomer"}],"firstRightId":3,"firstRightName":"客户管理","firstRightverify":"CustomerManage"},{"childRights":[{"id":6,"rightName":"查询排期","verify":"QueryScheduling"},{"id":7,"rightName":"查看投放订单","verify":"ViewPutOrder"},{"id":8,"rightName":"管理投放订单","verify":"ManagePutOrders"},{"id":9,"rightName":"总公司业务一审","verify":"HeadCompanyFirstInstance"},{"id":10,"rightName":"总公司业务二审","verify":"HeadCompanySecondInstance"},{"id":11,"rightName":"分公司审核","verify":"BranchCompanyFirstInstance"},{"id":12,"rightName":"分公司二审","verify":"BranchCompanySecondInstance"},{"id":15,"rightName":"查看合同","verify":"ViewContract"},{"id":16,"rightName":"管理合同","verify":"ManageContract"},{"id":19,"rightName":"查看默认订单","verify":"ViewDefaultOrder"},{"id":20,"rightName":"默认订单管理","verify":"ManageDefaultOrder"},{"id":21,"rightName":"紧急订单管理","verify":"EmergencyOrderManagement"},{"id":22,"rightName":"紧急创意审核","verify":"EmergencyCreativeAudit"},{"id":23,"rightName":"紧急订单审核","verify":"EmergencyOrderReview"},{"id":24,"rightName":"默认订单审核","verify":"DefaultOrderReview"},{"id":25,"rightName":"默认创意审核","verify":"DefaultCreativeReview"},{"id":148,"rightName":"内容管理","verify":"ManageContent"},{"id":149,"rightName":"内容审核","verify":"AuditContent"},{"id":150,"rightName":"内容查看","verify":"ViewContent"},{"id":153,"rightName":"订单数据权限","verify":"OrderDataAuthority"},{"id":157,"rightName":"修改投放订单状态","verify":"UpdatePutOrdersState"},{"id":158,"rightName":"作废投放订单、创意","verify":"StopPutOrdersState"},{"id":159,"rightName":"撤销预投放订单","verify":"RecallPutOrdersState"},{"id":172,"rightName":"查看审核流程","verify":"ViewAuditProcess"},{"id":173,"rightName":"管理审核流程","verify":"ManageAuditProcess"},{"id":174,"rightName":"查看排期广告位使用详情","verify":"ViewAdUsageDetails"},{"id":179,"rightName":"查看本人客户的订单","verify":"ViewOwnCustomerOrder"},{"id":191,"rightName":"监管创意","verify":"SuperviseCreative"},{"id":192,"rightName":"监管素材","verify":"SuperviseMaterial"},{"id":193,"rightName":"监管网络安全","verify":"SuperviseNetworkSecurity"},{"id":6,"rightName":"查询排期","verify":"QueryScheduling"},{"id":7,"rightName":"查看投放订单","verify":"ViewPutOrder"},{"id":8,"rightName":"管理投放订单","verify":"ManagePutOrders"},{"id":9,"rightName":"总公司业务一审","verify":"HeadCompanyFirstInstance"},{"id":10,"rightName":"总公司业务二审","verify":"HeadCompanySecondInstance"},{"id":11,"rightName":"分公司审核","verify":"BranchCompanyFirstInstance"},{"id":12,"rightName":"分公司二审","verify":"BranchCompanySecondInstance"},{"id":15,"rightName":"查看合同","verify":"ViewContract"},{"id":16,"rightName":"管理合同","verify":"ManageContract"},{"id":19,"rightName":"查看默认订单","verify":"ViewDefaultOrder"},{"id":20,"rightName":"默认订单管理","verify":"ManageDefaultOrder"},{"id":21,"rightName":"紧急订单管理","verify":"EmergencyOrderManagement"},{"id":22,"rightName":"紧急创意审核","verify":"EmergencyCreativeAudit"},{"id":23,"rightName":"紧急订单审核","verify":"EmergencyOrderReview"},{"id":24,"rightName":"默认订单审核","verify":"DefaultOrderReview"},{"id":25,"rightName":"默认创意审核","verify":"DefaultCreativeReview"},{"id":148,"rightName":"内容管理","verify":"ManageContent"},{"id":149,"rightName":"内容审核","verify":"AuditContent"},{"id":150,"rightName":"内容查看","verify":"ViewContent"},{"id":153,"rightName":"订单数据权限","verify":"OrderDataAuthority"},{"id":157,"rightName":"修改投放订单状态","verify":"UpdatePutOrdersState"},{"id":158,"rightName":"作废投放订单、创意","verify":"StopPutOrdersState"},{"id":159,"rightName":"撤销预投放订单","verify":"RecallPutOrdersState"},{"id":172,"rightName":"查看审核流程","verify":"ViewAuditProcess"},{"id":173,"rightName":"管理审核流程","verify":"ManageAuditProcess"},{"id":174,"rightName":"查看排期广告位使用详情","verify":"ViewAdUsageDetails"}],"firstRightId":1,"firstRightName":"广告订单","firstRightverify":"AdOrder"},{"childRights":[{"id":26,"rightName":"查看媒体、频道、广告位","verify":"ViewMediaChannelADSpace"},{"id":27,"rightName":"管理媒体、频道、广告位","verify":"ManageMediaChannelADSpace"},{"id":28,"rightName":"编辑广告位刊例价","verify":"EditADPrice"},{"id":29,"rightName":"审核广告位","verify":"CheckADSpace"},{"id":30,"rightName":"禁用广告位","verify":"ForbidAD"},{"id":31,"rightName":"查看尺寸","verify":"ViewSize"},{"id":32,"rightName":"管理尺寸","verify":"ManageSize"},{"id":33,"rightName":"查看创意类型","verify":"ViewCreativeType"},{"id":34,"rightName":"管理创意类型","verify":"ManageCreativeType"},{"id":26,"rightName":"查看媒体、频道、广告位","verify":"ViewMediaChannelADSpace"},{"id":27,"rightName":"管理媒体、频道、广告位","verify":"ManageMediaChannelADSpace"},{"id":28,"rightName":"编辑广告位刊例价","verify":"EditADPrice"},{"id":29,"rightName":"审核广告位","verify":"CheckADSpace"},{"id":30,"rightName":"禁用广告位","verify":"ForbidAD"},{"id":31,"rightName":"查看尺寸","verify":"ViewSize"},{"id":32,"rightName":"管理尺寸","verify":"ManageSize"},{"id":33,"rightName":"查看创意类型","verify":"ViewCreativeType"},{"id":34,"rightName":"管理创意类型","verify":"ManageCreativeType"}],"firstRightId":2,"firstRightName":"资源管理","firstRightverify":"ResourceManage"},{"childRights":[{"id":40,"rightName":"查看客户报表","verify":"ViewCustomerReport"},{"id":41,"rightName":"查看资源消耗报表","verify":"ViewResourceConsumptionReport"},{"id":42,"rightName":"查看广告投放报表","verify":"ViewAdvertisingReport"},{"id":44,"rightName":"查看订单消耗报表","verify":"ViewOrderCostReport"},{"id":45,"rightName":"查看合同消耗报表","verify":"ViewContractCostReport"},{"id":200,"rightName":"数据概要","verify":"ViewDataSummary"},{"id":40,"rightName":"查看客户报表","verify":"ViewCustomerReport"},{"id":41,"rightName":"查看资源消耗报表","verify":"ViewResourceConsumptionReport"},{"id":42,"rightName":"查看广告投放报表","verify":"ViewAdvertisingReport"},{"id":44,"rightName":"查看订单消耗报表","verify":"ViewOrderCostReport"},{"id":45,"rightName":"查看合同消耗报表","verify":"ViewContractCostReport"}],"firstRightId":4,"firstRightName":"数据报表","firstRightverify":"DataReport"},{"childRights":[{"id":46,"rightName":"查看公司","verify":"ViewCompany"},{"id":47,"rightName":"管理公司","verify":"ManageCompany"},{"id":48,"rightName":"查看部门","verify":"ViewDepartment"},{"id":49,"rightName":"管理部门","verify":"ManageDepartment"},{"id":50,"rightName":"查看角色","verify":"ViewRole"},{"id":51,"rightName":"管理角色","verify":"ManageRole"},{"id":52,"rightName":"查看用户","verify":"ViewUser"},{"id":53,"rightName":"管理用户","verify":"ManageUser"},{"id":54,"rightName":"查看容错率","verify":"ViewTolerantRate"},{"id":55,"rightName":"管理容错率","verify":"ManageTolerantRate"},{"id":56,"rightName":"查看公告","verify":"ViewNotice"},{"id":57,"rightName":"管理公告","verify":"ManageNotice"},{"id":58,"rightName":"查看操作日志","verify":"ViewOperationLog"},{"id":63,"rightName":"查看广告角标","verify":"ViewADMark"},{"id":64,"rightName":"管理广告角标","verify":"ManageADMark"},{"id":151,"rightName":"特效查看","verify":"ViewSpecialEffects"},{"id":152,"rightName":"特效管理","verify":"ManageSpecialEffects"},{"id":177,"rightName":"查看监控","verify":"ViewMonitor"},{"id":178,"rightName":"管理监控","verify":"ManageMonitor"},{"id":46,"rightName":"查看公司","verify":"ViewCompany"},{"id":47,"rightName":"管理公司","verify":"ManageCompany"},{"id":48,"rightName":"查看部门","verify":"ViewDepartment"},{"id":49,"rightName":"管理部门","verify":"ManageDepartment"},{"id":50,"rightName":"查看角色","verify":"ViewRole"},{"id":51,"rightName":"管理角色","verify":"ManageRole"},{"id":52,"rightName":"查看用户","verify":"ViewUser"},{"id":53,"rightName":"管理用户","verify":"ManageUser"},{"id":54,"rightName":"查看容错率","verify":"ViewTolerantRate"},{"id":55,"rightName":"管理容错率","verify":"ManageTolerantRate"},{"id":56,"rightName":"查看公告","verify":"ViewNotice"},{"id":57,"rightName":"管理公告","verify":"ManageNotice"},{"id":58,"rightName":"查看操作日志","verify":"ViewOperationLog"},{"id":63,"rightName":"查看广告角标","verify":"ViewADMark"},{"id":64,"rightName":"管理广告角标","verify":"ManageADMark"},{"id":151,"rightName":"特效查看","verify":"ViewSpecialEffects"},{"id":152,"rightName":"特效管理","verify":"ManageSpecialEffects"}],"firstRightId":5,"firstRightName":"系统设置","firstRightverify":"SystemSet"}]}'

var res = JSON.parse(rule);

var rules = {};

if(res && res.code == 200){
    var items = res.items;
    for(var i = 0,j = items.length;i<j;i++){
        var item = items[i];
        if(item.childRights && item.childRights.length > 0){
            rules[item.firstRightId] = item.childRights;
        }
    }
}

console.dir(rules);

var menus = {
    '1':[{name:'QueryScheduling',title:'查询排期',url:'ADManage/listManage.html'},{name:'ViewPutOrder',title:'投放订单',url:'ADManage/putListManage.html'},{name:'ViewContract',title:'合同管理',url:'ADManage/contractList.html'},{name:'ViewDefaultOrder',title:'默认广告',url:'ADManage/trueAdvertisement.html'},{name:'ViewContent',title:'内容管理',url:'ADManage/contentManage.html'},{name:'ViewAuditProcess',title:'流程管理',url:'ADManage/processList.html'}]
}

window.onload = function () {
    var menu = document.querySelector('.frame-menu .menu');
    menu.addEventListener('click', function (e) {
        var ele = e.target;
        if (ele.nodeName == 'P') {
            var p = ele.nextElementSibling;
            if (!p.classList.contains('active')) {
                height(p, 0);
            } else {
                height(p, 1);
            }
        }
    })

    function height(p, bo) {
        var s = setInterval(function () {
            var h = p.offsetHeight;
            if (bo) {
                if (h <= 0) {
                    clearInterval(s);
                    p.classList.remove('active');
                } else {
                    p.style.height = h - 2;
                }
            } else {
                var ch = p.children[0].offsetHeight * p.children.length;
                if (h >= ch) {
                    clearInterval(s);
                    p.classList.add('active');
                } else {
                    p.style.height = h + 2;
                }
            }
        }, 3)
    }
}

// window hash标志 iframe ID 
! function (win, key, frame) {
    function Route() {
        this.regex = {};
        this.data = {};
    }

    var _self;
    if (!win.top.$R) {
        _self = win.top.$R = new Route();
    }

    Route.prototype.changeState = function (hash) {
        if (hash) {
            var url = this.getUrl(hash);
            var iframe = document.getElementById(frame);
            iframe.contentWindow.location.replace(url);
            return true;
        }
    };

    Route.prototype.getHash = function () {
        var r = '#' + key;
        return location.hash.substr(r.length + 1);
    };

    Route.prototype.getUrl = function (hash) {
        return this.regex[hash]
    };

    //name url 
    Route.prototype.reg = function (o) {
        if (o instanceof Array) {
            for (var i = 0, j = o.length; i < j; i++) {
                var r = o[i];
                if (!r.name || !r.url) continue;
                this.regex[r.name] = r.url;
            }
        } else {
            if (!o.name || !o.url) return this;
            this.regex[o.name] = o.url;
        }
        return this;
    };

    Route.prototype.listen = function () {
        win.top.onhashchange = function (event) {
            var hash = _self.getHash();
            if (_self.getUrl(hash)) {
                _self.changeState(hash);
            }
        }
    };
    //_hash 默认hash 没有注册的路由就会跳到这个默认的路由上
    Route.prototype.start = function (_hash) {
        var a = win.top.document.querySelectorAll('a[data-route]');
        if (a && a.length > 0) {
            for (var i = 0, j = a.length; i < j; i++) {
                var _a = a[i];
                var r = _a.getAttribute('data-route');
                _a.setAttribute('href', '#' + key + '/' + r);
            }
        }
        var hash = _self.getHash();
        if (_self.getUrl(hash)) {
            _self.changeState(hash);
        } else if (_hash) {
            _self.changeState(_hash);
            top.location.hash = key + '/' + _hash;
        }
        _self.listen();
    };

    Route.prototype.searchJSON = function(url,obj){
        !obj && (obj = {});
        var l = url.indexOf('?');
        if(l != -1){
            var s = url.substr(l+1,l.length);
            var _s = s.split("&");
            for (var i = 0; i < _s.length; i++) {
                var _ss = _s[i];
                var _sss = _ss.split('=');
                obj[_sss[0]] = _sss[1];
            }
        }
    }

    Route.prototype.go = function (hash, data) {
        !data && (data = {});
        this.searchJSON(hash,data);
        var l = hash.indexOf('?');
        var url = l == -1 ? (hash):(hash.substr(0,l));
        if (_self.getUrl(url)) {
            top.location.hash = '#' + key + '/' + url;
            _self.data = data;
        }
    }
}(this.top, '!', 'iframe');
